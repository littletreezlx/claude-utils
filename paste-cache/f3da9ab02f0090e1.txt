~/LittleTree_Projects/flutter/littletree_ai/server on  master ⌚ 10:00:58
$ pnpm lint

> littletree-ai-server@0.1.0 lint /Users/zhanglingxiao/LittleTree_Projects/flutter/littletree_ai/server
> biome check src test --files-ignore-unknown=true

src/services/rag/embedding.service.ts:181:18 lint/style/noNonNullAssertion ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  ⚠ Forbidden non-null assertion.

    180 │   for (let i = 0; i < texts.length; i++) {
  > 181 │     const text = texts[i]!;
        │                  ^^^^^^^^^
    182 │     const cached = useCache ? embeddingCache.get(text) : null;
    183 │


src/services/rag/embedding.service.ts:225:25 lint/style/noNonNullAssertion ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  ⚠ Forbidden non-null assertion.

    223 │     // 填充结果并更新缓存
    224 │     for (let j = 0; j < sortedData.length; j++) {
  > 225 │       const batchItem = batch[j]!;
        │                         ^^^^^^^^^
    226 │       const sortedItem = sortedData[j]!;
    227 │       const originalIndex = batchItem.index;


src/services/rag/embedding.service.ts:226:26 lint/style/noNonNullAssertion ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  ⚠ Forbidden non-null assertion.

    224 │     for (let j = 0; j < sortedData.length; j++) {
    225 │       const batchItem = batch[j]!;
  > 226 │       const sortedItem = sortedData[j]!;
        │                          ^^^^^^^^^^^^^^
    227 │       const originalIndex = batchItem.index;
    228 │       const embedding = sortedItem.embedding;


src/services/rag/embedding.service.ts:230:7 lint/style/noNonNullAssertion ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  ⚠ Forbidden non-null assertion.

    228 │       const embedding = sortedItem.embedding;
    229 │
  > 230 │       results[originalIndex]!.embedding = embedding;
        │       ^^^^^^^^^^^^^^^^^^^^^^^
    231 │
    232 │       if (useCache) {


src/core/prompt-builder.ts:13:1 assist/source/organizeImports  FIXABLE  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  ✖ The imports and exports are not sorted.

    12 │ // Re-export everything from the new module structure
  > 13 │ export {
       │ ^^^^^^^^
  > 14 │   buildSystemPrompt,
        ...
  > 30 │   unescapeXml,
  > 31 │ } from "./prompt-builder/index.js";
       │ ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    32 │
    33 │ export type {

  ℹ Safe fix: Organize Imports (Biome)

    10 10 │    */
    11 11 │
    12    │ - //·Re-export·everything·from·the·new·module·structure
    13    │ - export·{
    14    │ - ··buildSystemPrompt,
    15    │ - ··countLines,
    16    │ - ··createCodeFileItem,
    17    │ - ··createPdfFileItem,
    18    │ - ··createPromptBuilder,
    19    │ - ··createTextFileItem,
    20    │ - ··detectLanguage,
    21    │ - ··escapeXml,
    22    │ - ··formatFileContext,
    23    │ - ··formatHistorySummary,
    24    │ - ··formatPlugins,
    25    │ - ··formatSearchResults,
    26    │ - ··isCodeFile,
    27    │ - ··normalizeLineEndings,
    28    │ - ··PromptBuilder,
    29    │ - ··truncateContent,
    30    │ - ··unescapeXml,
       12 │ +
       13 │ + export·type·{
       14 │ + ··BuildOptions,
       15 │ + ··FileItem,
       16 │ + ··FilePage,
       17 │ + ··FormatFileContextOptions,
       18 │ + ··PromptParts,
       19 │ + ··SearchResultItem,
    31 20 │   } from "./prompt-builder/index.js";
    32    │ -
    33    │ - export·type·{
    34    │ - ··BuildOptions,
    35    │ - ··FileItem,
    36    │ - ··FilePage,
    37    │ - ··FormatFileContextOptions,
    38    │ - ··PromptParts,
    39    │ - ··SearchResultItem,
       21 │ + //·Re-export·everything·from·the·new·module·structure
       22 │ + export·{
       23 │ + ··buildSystemPrompt,
       24 │ + ··countLines,
       25 │ + ··createCodeFileItem,
       26 │ + ··createPdfFileItem,
       27 │ + ··createPromptBuilder,
       28 │ + ··createTextFileItem,
       29 │ + ··detectLanguage,
       30 │ + ··escapeXml,
       31 │ + ··formatFileContext,
       32 │ + ··formatHistorySummary,
       33 │ + ··formatPlugins,
       34 │ + ··formatSearchResults,
       35 │ + ··isCodeFile,
       36 │ + ··normalizeLineEndings,
       37 │ + ··PromptBuilder,
       38 │ + ··truncateContent,
       39 │ + ··unescapeXml,
    40 40 │   } from "./prompt-builder/index.js";
    41 41 │


src/core/prompt-builder/index.ts:23:1 assist/source/organizeImports  FIXABLE  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  ✖ The imports and exports are not sorted.

    21 │  */
    22 │
  > 23 │ import { logger } from "../../utils/logger.js";
       │ ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    24 │ import type { FileItem, SearchResultItem } from "../../utils/xml-utils.js";
    25 │ import { formatFileContext, formatSearchResults } from "../../utils/xml-utils.js";

  ℹ Safe fix: Organize Imports (Biome)

     28  28 │   import type { BuildOptions, PromptParts } from "./types.js";
     29  29 │
     30     │ - //·Re-export·types
     31     │ - export·type·{·BuildOptions,·PromptParts·}·from·"./types.js";
     32     │ - export·{·formatHistorySummary,·formatPlugins·}·from·"./formatters.js";
     33     │ -
     34     │ - //·Re-export·types·from·xml-utils·for·backward·compatibility
     35     │ - export·type·{
     36     │ - ··FileItem,
     37     │ - ··FilePage,
     38     │ - ··FormatFileContextOptions,
     39     │ - ··SearchResultItem,
     40     │ - }·from·"../../utils/xml-utils.js";
     41     │ -
     42     │ - //·Re-export·formatting·functions·from·xml-utils·for·backward·compatibility
     43     │ - export·{·formatFileContext,·formatSearchResults·}·from·"../../utils/xml-utils.js";
     44     │ -
     45     │ - //·Re-export·XML·utilities·for·backward·compatibility
     46     │ - export·{
     47     │ - ··countLines,
     48     │ - ··createCodeFileItem,
     49     │ - ··createPdfFileItem,
     50     │ - ··createTextFileItem,
     51     │ - ··detectLanguage,
     52     │ - ··escapeXml,
     53     │ - ··isCodeFile,
     54     │ - ··normalizeLineEndings,
     55     │ - ··truncateContent,
     56     │ - ··unescapeXml,
     57     │ - }·from·"../../utils/xml-utils.js";
         30 │ +
         31 │ + //·Re-export·types·from·xml-utils·for·backward·compatibility
         32 │ + export·type·{
         33 │ + ··FileItem,
         34 │ + ··FilePage,
         35 │ + ··FormatFileContextOptions,
         36 │ + ··SearchResultItem,
         37 │ + }·from·"../../utils/xml-utils.js";
         38 │ + //·Re-export·formatting·functions·from·xml-utils·for·backward·compatibility
         39 │ + //·Re-export·XML·utilities·for·backward·compatibility
         40 │ + export·{·
         41 │ + ··countLines,
         42 │ + ··createCodeFileItem,
         43 │ + ··createPdfFileItem,
         44 │ + ··createTextFileItem,
         45 │ + ··detectLanguage,
         46 │ + ··escapeXml,formatFileContext,·formatSearchResults,·
         47 │ + ··isCodeFile,
         48 │ + ··normalizeLineEndings,
         49 │ + ··truncateContent,
         50 │ + ··unescapeXml,}·from·"../../utils/xml-utils.js";
         51 │ + export·{·formatHistorySummary,·formatPlugins·}·from·"./formatters.js";
         52 │ + //·Re-export·types
         53 │ + export·type·{·BuildOptions,·PromptParts·}·from·"./types.js";
     58  54 │
     59  55 │   /**


src/services/image-generation.service.ts:10:1 assist/source/organizeImports  FIXABLE  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  ✖ The imports and exports are not sorted.

     8 │  */
     9 │
  > 10 │ export {
       │ ^^^^^^^^
  > 11 │   imageGenerationService,
  > 12 │   ImageStorage,
  > 13 │   OpenRouterClient,
  > 14 │   parseDimension,
  > 15 │   validateImageRequest,
  > 16 │ } from "./image-generation/index.js";
       │ ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    17 │

  ℹ Safe fix: Organize Imports (Biome)

     9  9 │
    10 10 │   export {
    11    │ - ··imageGenerationService,
    12    │ - ··ImageStorage,
       11 │ + ··ImageStorage,
       12 │ + ··imageGenerationService,
    13 13 │     OpenRouterClient,
    14 14 │     parseDimension,


src/services/image-generation/image-storage.ts format ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  ✖ Formatter would have printed the following content:

     43  43 │      * Save image from base64 data
     44  44 │      */
     45     │ - ··async·saveImage(
     46     │ - ····userId:·string,
     47     │ - ····imageId:·string,
     48     │ - ····base64Data:·string
     49     │ - ··):·Promise<SavedImageInfo>·{
         45 │ + ··async·saveImage(userId:·string,·imageId:·string,·base64Data:·string):·Promise<SavedImageInfo>·{
     50  46 │       const userDir = await this.ensureUserDir(userId);
     51  47 │


Checked 189 files in 164ms. No fixes applied.
Found 4 errors.
Found 4 warnings.
check ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━