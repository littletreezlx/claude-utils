上下文：UI 文档驱动约束强化项目

  起因

  用户在开发 Flutter 项目集合时发现：
  - CLAUDE.md 中虽然提到"三位一体"（Code ⇄ Test ⇄ Doc）和"UI 文档驱动"
  - 但缺少明确的强制约束，AI 可能不会主动查阅 Spec
  - UI 代码与 Spec 文档可能不一致，缺乏验证机制

  问题本质

  核心认知缺口：
  1. 框架层有"UI 文档驱动"流程描述，但语气是"建议"而非"强制"
  2. 项目层缺少明确的"UI 修改强制流程"章节
  3. 命令层（/ui-spec、/feat-discuss）缺少前置检查和验证机制

  项目架构

  ~/LittleTree_Projects/flutter/
  ├── CLAUDE.md                    # 框架层：所有 Flutter 项目共享
  ├── lt-music/                    # 音乐播放器
  ├── littletree_ai/               # AI 聊天助手
  ├── flametree_rss_reader/        # RSS 阅读器（本次修改的项目）
  │   ├── CLAUDE.md                # 项目层
  │   └── docs/ui/specs/           # Spec 文档目录
  └── [其他子项目]

  ---
  我实施的修改

  修改 1：框架层 CLAUDE.md

  文件：~/LittleTree_Projects/flutter/CLAUDE.md

  新增章节："UI 文档驱动开发 (Spec-Driven Development)" (~90 行)

  核心内容：
  ## UI 文档驱动开发 (Spec-Driven Development)

  ### 核心原则
  > UI 逻辑必须与 Spec 文档对应 — 修改 UI 代码前必须查阅 Spec，修改后必须同步更新 Spec

  ### 三位一体一致性（UI 专用）
  UI Spec (逻辑定义) ⇄ UI Code (实现) ⇄ E2E Test (验证)

  ### Spec 文档维护规则
  **必须创建 Spec 的场景**：
  - ✅ 新建页面或复杂组件
  - ✅ UI 逻辑修改影响用户交互
  - ✅ 状态管理或数据流变更

  **必须更新 Spec 的场景**：
  - ✅ 修改了组件的交互行为
  - ✅ 新增或删除了状态字段
  - ✅ 改变了布局结构或响应式逻辑

  语气：推荐（引导性），使用"应该"、"推荐"等词汇

  影响范围：所有 Flutter 子项目（lt-music、littletree_ai、flametree_rss_reader 等）

  ---
  修改 2：项目层 CLAUDE.md

  文件：flametree_rss_reader/CLAUDE.md

  新增章节："UI 修改强制流程 (Spec-Driven UI Development)" (~70 行)

  核心内容：
  ## UI 修改强制流程

  ### 强制流程（5 步法）
  1. 定位 Spec - 检查 docs/ui/specs/{page_name}_spec.md 是否存在
  2. 查阅 Spec - 理解核心目标、交互、状态、数据
  3. 对比现状 - 分析代码与 Spec 的差异
  4. 实施修改 - 基于最新 Spec 进行代码修改
  5. 同步更新 - 代码修改完成后立即更新 Spec

  ### 负面约束（禁止行为）
  ❌ 未经查阅 Spec 直接修改 UI 代码
  ❌ 修改代码后不同步更新 Spec
  ❌ Spec 与代码长期不一致

  > 补救措施：如果发现 Spec 过时，优先运行 /ui-spec 重新生成

  语气：强制（约束性），使用"必须"、"禁止"等词汇

  影响范围：仅 flametree_rss_reader 项目

  ---
  修改 3：UI_SHOWCASE_MAPPING.md

  文件：docs/ui/UI_SHOWCASE_MAPPING.md

  新增内容：
  - UI 文档驱动规范说明
  - 5 步法流程概述
  - 完整性目标表格（跟踪每个页面的 Spec/测试/截图状态）

  ---
  修改 4：创建 Spec 文档

  创建了 3 个核心页面的完整 Spec 文档：
  - docs/ui/specs/login_spec.md (258 行)
  - docs/ui/specs/home_spec.md (298 行)
  - docs/ui/specs/article_reader_spec.md (332 行)

  每个 Spec 包含：
  1. 核心目标
  2. 交互与手势（表格形式）
  3. 状态定义
  4. 关键数据
  5. 错误处理
  6. 数据流图
  7. 组件关系图

  ---
  我的设计决策

  决策 1：分层语气差异
  ┌────────┬────────────────┬────────────────────────────┐
  │  层级  │      语气      │            理由            │
  ├────────┼────────────────┼────────────────────────────┤
  │ 框架层 │ "推荐"、"应该" │ 不强制所有项目，保持灵活性 │
  ├────────┼────────────────┼────────────────────────────┤
  │ 项目层 │ "必须"、"禁止" │ 在具体项目中强制执行       │
  └────────┴────────────────┴────────────────────────────┘
  理由：不同项目可能有不同的开发需求，框架层提供标准，项目层决定是否强制。

  决策 2：负面约束优先

  采用"负面清单"明确禁止行为，而非只说"应该做什么"。

  理由：符合全局 CLAUDE.md 的认知框架："负面约束比正面指令更能防止 Bug"。

  决策 3：仅修改一个项目

  只修改了 flametree_rss_reader 的项目层 CLAUDE.md，未修改 lt-music、littletree_ai 等其他项目。

  理由：
  - flametree_rss_reader 是主要测试场
  - 验证方案有效性后再推广
  - 避免一次性修改过多导致不可控

  ---
  需要你评估的问题

  问题 1：方案合理性评估

  请评估：

  1. 分层设计是否合理？
    - 框架层用"推荐"语气是否足够？
    - 项目层用"强制"语气是否过重？
    - 是否应该反过来（框架层强制，项目层灵活）？
  2. 负面约束策略是否有效？
    - 禁止行为列表是否完整？
    - 是否有遗漏的场景？
    - 补救措施是否合理？
  3. 5 步法是否过于复杂？
    - 5 个步骤是否可简化？
    - 每个步骤是否必要？
    - 是否会导致开发效率降低？
  4. 仅修改一个项目是否正确？
    - 是否应该立即修改所有项目？
    - 或者完全不应该修改框架层？
    - 其他项目可能不需要这么严格的约束？

  问题 2：是否需要修改所有项目

  请分析：

  1. lt-music 项目
    - 已有 UI_SHOWCASE.md 和 6 个 spec
    - 是否需要添加同样的强制流程？
    - 还是保持现有的轻量级约束？
  2. littletree_ai 项目
    - 已有 UI_SHOWCASE.md 和 specs
    - AI 聊天项目可能更注重快速迭代
    - 严格的文档约束是否合适？
  3. 未来新建项目
    - 应该默认启用强制流程？
    - 还是按项目性质决定？

  问题 3：潜在风险

  请识别：

  1. 过度文档化风险
    - 是否会影响开发效率？
    - AI 是否会因为流程复杂而忽略？
  2. 维护成本风险
    - Spec 与代码同步的成本
    - 文档过时的风险
  3. 团队协作风险
    - 如果未来有协作者，是否能接受？
    - 是否需要灵活的"开关"机制？

  ---
  相关文档完整内容

  框架层 CLAUDE.md（UI 文档驱动章节）

  ## UI 文档驱动开发 (Spec-Driven Development)

  ### 核心原则

  > **UI 逻辑必须与 Spec 文档对应** — 修改 UI 代码前必须查阅 Spec，修改后必须同步更新 Spec

  ### 三位一体一致性（UI 专用）

  UI Spec (逻辑定义) ⇄ UI Code (实现) ⇄ E2E Test (验证)

  **修改 UI 代码前的强制检查**：

  | 触发条件 | 强制流程 |
  |---------|---------|
  | 用户提及"修改界面"、"调整布局"、"优化 UI" | 1. 定位 Spec → 2. 查阅 Spec → 3. 对比现状 → 4. 实施修改 → 5. 同步更新 |
  | 涉及 `lib/features/*/pages/` 或 `widgets/` 的修改 | 同上 |
  | 组件交互、状态管理、数据流变更 | 同上 |

  ### Spec 文档维护规则

  **必须创建 Spec 的场景**：
  - ✅ 新建页面或复杂组件
  - ✅ UI 逻辑修改影响用户交互
  - ✅ 状态管理或数据流变更

  **必须更新 Spec 的场景**：
  - ✅ 修改了组件的交互行为
  - ✅ 新增或删除了状态字段
  - ✅ 改变了布局结构或响应式逻辑

  ### AI 协作命令

  | 命令 | 用途 | 输出 |
  |------|------|------|
  | `/ui-spec {code_path}` | 逆向分析代码，生成 Spec | `docs/ui/specs/{page}_spec.md` |
  | `/feat-discuss {需求}` | 讨论新功能，更新 Spec | 更新 `{page}_spec.md` |
  | `/ui-redesign {spec_path}` | 基于 Spec 进行视觉重塑 | 设计图 + 实现方案 |

  ### Spec 架构标准

  项目根目录/
  ├── UI_SHOWCASE.md              # 主索引
  └── docs/ui/
      ├── specs/                  # 功能规范（Spec 专属目录）
      │   ├── login_spec.md       # 登录页功能规范
      │   ├── home_spec.md        # 主页功能规范
      │   └── ...
      ├── screens.md              # 界面设计详情
      ├── components.md           # 组件库详情
      ├── theme.md                # 设计系统
      ├── responsive.md           # 响应式规范
      └── UI_SHOWCASE_MAPPING.md  # Spec-代码映射

  ### 命名规范（自动化分析依赖）

  代码文件: {page_name}_page.dart
  Spec 文件: {page_name}_spec.md
  截图文件: {page_name}.png

  > **注意**: Spec 文件应与代码文件保持名称一致，以支持自动化工具链

  ### Spec 文档模板（标准格式）

  ```markdown
  # [Page Name] Feature Spec

  **最后更新**: {YYYY-MM-DD}
  **对应代码**: `lib/path/to/file.dart`

  ## 1. 核心目标 (Core Purpose)
  *一句话描述用户来这个页面是为了做什么。*

  ## 2. 交互与手势 (Interactions)
  | UI 元素 | 触发操作 | 预期反馈/逻辑 | 代码映射 |
  |--------|---------|-------------|---------------|
  | ... | ... | ... | ... |

  ## 3. 状态定义 (State Definitions)
  *   **Loading**: ...
  *   **Empty**: ...
  *   **Error**: ...

  ## 4. 关键数据 (Key Data)
  *   **核心展示字段**: ...
  *   **数据源**: ...

  ---

  ### 项目层 CLAUDE.md（UI 修改强制流程章节）

  ```markdown
  ## UI 修改强制流程 (Spec-Driven UI Development)

  ### 触发条件

  当用户请求涉及以下内容时，**必须**执行 UI 文档驱动流程：
  - "修改界面"、"调整布局"、"优化 UI"
  - 涉及 `lib/features/*/pages/` 或 `lib/features/*/widgets/` 的修改
  - 组件交互、状态管理、数据流变更

  ### 强制流程（5 步法）

  #### 第 1 步：定位 Spec

  ```bash
  # 假设修改 home_page.dart
  # 对应 Spec: docs/ui/specs/home_spec.md

  检查 Spec 是否存在：
  - ✅ 存在 → 进入第 2 步
  - ❌ 不存在 → 先运行 /ui-spec lib/features/home/pages/home_page.dart 生成

  第 2 步：查阅 Spec

  # 读取 Spec 文档
  Read: docs/ui/specs/home_spec.md

  理解以下内容：
  - 核心目标
  - 交互与手势（用户能做什么？系统怎么反馈？）
  - 状态定义（正常/加载/空/错误/边界状态）
  - 关键数据（展示字段、数据源）

  第 3 步：对比现状

  分析代码与 Spec 的差异：
  - 代码是否实现了 Spec 中定义的所有交互？
  - 状态管理是否与 Spec 一致？
  - 组件结构是否与 Spec 匹配？

  第 4 步：实施修改

  基于最新 Spec 进行代码修改，同时：
  - 保留 Spec 中定义的核心逻辑
  - 新增功能需要先通过 /feat-discuss 讨论后，再更新 Spec

  第 5 步：同步更新

  代码修改完成后，立即更新 Spec：
  - 更新"组件结构"章节（如有新增组件）
  - 更新"状态定义"章节（如有状态变更）
  - 更新"交互与手势"章节（如有交互变更）

  验证清单

  完成 UI 修改后，必须确认：
  - Spec 文档已更新
  - 代码与 Spec 一致
  - E2E 测试通过（如有）
  - UI_SHOWCASE.md 已更新（如有结构性变更）

  负面约束（禁止行为）

  以下行为严格禁止：
  - ❌ 未经查阅 Spec 直接修改 UI 代码
  - ❌ 修改代码后不同步更新 Spec
  - ❌ Spec 与代码长期不一致

  补救措施: 如果发现 Spec 过时，优先运行 /ui-spec 重新生成，而非盲目修改代码

  ---

  ## 你的评估任务

  请作为一位**资深架构师**和**DevOps 专家**，从以下角度进行深度评估：

  1. **架构合理性**：分层设计、语气选择、约束强度是否合理？
  2. **实践可行性**：5 步法是否可执行？是否会显著降低开发效率？
  3. **推广策略**：是否需要修改所有项目？还是保持现状？
  4. **风险控制**：潜在风险是否可控？是否有更好的缓解方案？
  5. **替代方案**：是否有更简单、更有效的方案？

  请给出：
  - ✅ 建议保留的部分
  - ⚠️ 需要调整的部分
  - ❌ 应该删除的部分
  - 💡 额外的改进建议

  **重要**：请基于实际的个人 Flutter 项目开发场景（非团队协作），给出务实的建议。
