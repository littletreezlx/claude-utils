# 快速健康检查（Quick Health Check）

> **用途**：单次会话快速检查项目整体状况
>
> **对比**：
> - **本 command**：快速概览（单次会话，浅层扫描）
> - **全面检查**：`/comprehensive-health-check`（多会话，深度分析）

---

## 🎯 何时使用？

✅ **适用场景**：
- 需要快速了解项目整体状况
- 时间紧急，无法进行全面深度检查
- 定期快速检查（例如每周）
- 确定是否需要进行全面检查

❌ **不适用场景**：
- 需要深度分析每个模块
- 需要实际运行所有测试
- 需要逐文件审查代码质量
- 发现"只见森林不见树木"的深层问题

---

## 📋 检查原则

**参考框架**：`~/.claude/frameworks/DEEP_ANALYSIS_FRAMEWORK.md`

**核心原则**：
```
代码 (What & How)  ←→  测试 (Verify)
  ↑                      ↑
  └──────  文档 (Why) ──┘
```

---

## 🚀 检查流程

### Step 1: 项目概览（5分钟）

**读取关键文档**：
- `README.md` - 项目介绍、启动指南
- `FEATURE_CODE_MAP.md`（如果有）- 功能映射
- `PROJECT_STATUS.md`（如果有）- 项目状态
- `docs/testing/COVERAGE_MAP.md`（如果有）- 测试覆盖

**快速评估**：
- [ ] 项目类型和技术栈
- [ ] 核心模块数量
- [ ] 文档是否完整
- [ ] 测试文件分布

---

### Step 2: 文档完整性（快速检查）

#### 2.1 核心文档存在性
- [ ] `README.md` 存在且包含基本信息
- [ ] 有启动指南和测试说明
- [ ] `FEATURE_CODE_MAP.md` 或类似功能映射（推荐）
- [ ] 架构决策记录（如 `docs/decisions/INDEX.md`）

#### 2.2 文档质量（抽查）
- [ ] README 信息是否过时？
- [ ] 功能映射是否准确？（抽查 3 个功能）
- [ ] 是否有明显的重要功能未记录？

**输出**：
- ✅ 完整的文档
- ⚠️ 不完整或过时的文档
- ❌ 缺失的重要文档

---

### Step 3: 测试覆盖（快速扫描）

#### 3.1 测试基础设施
- [ ] 测试命令是否配置？（检查 package.json / pytest.ini）
- [ ] 测试框架是否正确配置？
- [ ] 是否有 E2E、单元、集成测试？

#### 3.2 核心功能测试覆盖（抽查）
识别 5 个核心功能（基于 FEATURE_CODE_MAP.md 或代码复杂度）：
- [ ] 是否有对应的测试文件？
- [ ] 测试文件命名是否规范？
- [ ] 测试描述是否清晰？

**注意**：快速检查只看测试文件是否存在，不实际运行测试

**输出**：
- 测试文件分布（E2E / 单元 / 集成）
- 核心功能缺失测试列表（top 5）
- 估算的测试覆盖度（基于文件数量）

---

### Step 4: 代码-测试-文档一致性（抽查）

选择 2-3 个重要功能，快速检查：

#### 4.1 文档 vs 代码
- [ ] 文档描述的功能是否在代码中实现？
- [ ] 实现方式是否与文档一致？

#### 4.2 测试 vs 文档
- [ ] 测试是否验证了文档描述的场景？
- [ ] 是否有测试验证了但文档未说明的行为?

**输出**：
- 发现的不一致案例（具体到文件路径）
- 建议的修复方向

---

### Step 5: 代码质量（快速扫描）

#### 5.1 文件规模
```bash
# 查找超大文件
find . -name "*.ts" -o -name "*.py" | xargs wc -l | sort -rn | head -10
```

- [ ] 是否有文件超过 600 行？
- [ ] 是否有明显的"巨型文件"？

#### 5.2 文档注释（抽查关键文件）
检查 3-5 个核心业务逻辑文件：
- [ ] 是否有文件顶部注释说明目的？
- [ ] 是否记录了关键设计决策？
- [ ] 是否链接了相关测试和文档？

**输出**：
- 超大文件列表（> 600 行）
- 缺少注释的关键文件（top 5）

---

## 📊 输出格式

### 对话中展示摘要

```markdown
## 快速健康检查摘要

**项目**：[项目名称]
**检查时间**：[日期]

---

### 📊 总体评估

| 维度 | 评分 | 状态 |
|------|------|------|
| 文档完整性 | 7/10 | 🟡 中等 |
| 测试覆盖度 | 6/10 | 🟡 中等 |
| 代码-测试-文档一致性 | 8/10 | 🟢 良好 |
| 代码质量 | 7/10 | 🟡 中等 |
| **综合评分** | **7/10** | 🟡 **整体良好，有改进空间** |

---

### 🚨 关键发现（top 5）

1. **[问题标题]** - 优先级：高
   - 位置：`path/to/file:line`
   - 影响：[影响描述]
   - 建议：[修复建议]

2. **[问题标题]** - 优先级：高
   ...

---

### 💡 建议下一步

#### 立即行动（高优先级）
- [ ] [任务 1] - 预计时间：X 小时
- [ ] [任务 2] - 预计时间：X 小时

#### 建议改进（中优先级）
- [ ] [任务 3]
- [ ] [任务 4]

#### 是否需要全面检查？
基于快速检查结果：
- ✅ **建议进行全面检查** - 发现 X 个潜在深层问题
- ⏸️ **暂不需要** - 整体状况良好

如需全面检查，运行：`/comprehensive-health-check`
```

---

### 生成文档（可选）

**只在发现较多问题时生成**：

#### 方案 A：问题较少（< 10个）
只在对话中展示，不生成文件

#### 方案 B：问题较多（≥ 10个）
生成 `TODO.md`：
```markdown
# 快速健康检查 - 改进清单

检查时间：YYYY-MM-DD
总体评分：X/10

## 🎯 优先级行动计划

### 第一优先级（本周）
- [ ] 任务 1 - 文件：`path/file.ts:123` - 预计：2h
- [ ] 任务 2 - ...

### 第二优先级（本月）
- [ ] 任务 3 - ...

## 📋 问题详情

### 1. [问题标题]
- **位置**：`path/file.ts:123`
- **问题**：[描述]
- **影响**：[影响]
- **建议**：[修复方案]
- **预计工作量**：[时间]

### 2. [问题标题]
...

## 🔄 后续建议

- [ ] 补充缺失的文档
- [ ] 补充核心功能测试
- [ ] 运行全面健康检查（如有必要）
```

---

## 🎯 检查深度说明

### 快速检查 vs 全面检查

| 维度 | 快速检查（本 command） | 全面检查（/comprehensive-health-check） |
|------|------------------------|------------------------------------------|
| **会话数** | 1 次会话 | 10+ 次会话 |
| **任务粒度** | 全面浅层扫描 | 每次专注单个模块深度分析 |
| **文档检查** | 存在性 + 抽查 | Layer 1/2/3 完整验证 |
| **测试检查** | 看文件是否存在 | **实际运行所有测试** |
| **代码审查** | 统计文件大小 | **逐文件深度审查** |
| **覆盖范围** | 抽查 5 个核心功能 | 全部核心模块（10+） |
| **问题深度** | 表面结构问题 | **深层内部质量问题** |
| **适用场景** | 快速了解、定期检查 | 深度诊断、重构前评估 |

### 何时应该升级到全面检查？

✅ **建议升级的情况**：
- 快速检查发现 10+ 个潜在问题
- 发现测试覆盖度很低（< 50%）
- 发现多个代码-测试-文档不一致
- 接手项目需要深入了解
- 重大重构前需要全面评估

**升级方法**：
```bash
/comprehensive-health-check
```

---

## 📚 相关文档

- **深度分析框架**：`~/.claude/frameworks/DEEP_ANALYSIS_FRAMEWORK.md`
- **全面健康检查**：`~/.claude/commands/comprehensive-health-check.md`
- **E2E 专项检查**：`~/.claude/commands/e2e-readiness.md`
- **项目级重构**：`~/.claude/commands/refactor-project.md`（DAG 模式）
- **模块级重构**：`~/.claude/commands/refactor-module.md`（DAG 模式）
- **测试规划**：`~/.claude/commands/test-plan.md`（DAG 模式）

---

## ⚙️ 执行选项

### 标准模式（默认）
```bash
/health-check
```
- 快速扫描全局
- 在对话中展示摘要
- 只在问题较多时生成 TODO.md

### 详细模式（可选）
```bash
/health-check --详细
```
- 增加抽查样本数量
- 生成更详细的报告

---

## 开始检查

现在开始对当前项目进行快速健康检查，按照上述流程执行。

**注意事项**：
- 优先完整性，而非速度
- 每个发现都要具体到文件路径
- 明确标注优先级（高/中/低）
- 如发现深层问题，建议升级到全面检查
