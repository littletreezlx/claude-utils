---
description: 大任务智能拆分与 DAG 编排

---

# 大任务智能拆分与 DAG 编排

## 核心目标
将复杂任务智能拆分为 DAG 编排的多阶段执行计划，输出 `batchcc.py` 可执行的任务文件。

**关键约束**：生成的任务将由**低智能模型**（如 GLM4.7）执行，必须遵循"执行模型友好规范"。

## 输入方式
```bash
/todo-huge-task "实现完整的用户管理系统"
/todo-huge-task $ARGUMENTS
```

---

## 🤖 自主执行原则

**⛔ 强制前置阅读**：
1. @templates/workflow/DAG_TASK_FORMAT.md 的"自主执行原则"章节
2. @templates/workflow/DAG_TASK_FORMAT.md 的"执行模型友好规范"章节 ⭐

**核心**：DAG 任务 = 完全自动化、无人值守执行

✅ **应该做**：自主分析 → 自主决策 → 直接执行 → 记录理由
❌ **不应该**：询问用户、列选项、等待确认

**决策失败时**：标记任务 `failed`，说明原因和可选方案

---

## 执行策略

### 1. 理解任务全貌
- 核心目标是什么？
- 涉及哪些功能模块？
- 需要哪些基础设施？
- 有哪些技术约束？
- **项目技术栈是什么？**（执行者需要知道）

### 2. 识别自然阶段

| 阶段 | 典型任务 | 执行模式 |
|------|---------|---------|
| 基础设施 | 数据库 schema、配置、第三方服务 | 串行 |
| 业务模块 | 用户、订单、支付等独立模块 | **并行** |
| 前端页面 | 各功能模块的 UI（可用 mock） | **并行** |
| 集成测试 | 模块间集成、API 联调 | 部分串行 |
| E2E 测试 | 完整业务流程验证 | **并行** |

### 3. 任务拆分原则

**粒度**：
- ✅ 功能模块级（model + service + controller + 测试）
- ❌ 太细（单文件）或太粗（整个系统）

**文件范围**：必须详细标注，用于自动冲突检测

### 4. ⭐ 增强任务格式（必须遵循）

每个 TASK 必须使用以下格式，确保低智能执行模型能正确理解：

```markdown
## TASK ##
[任务标题 - 一句话说明要做什么]

**🏠 项目背景**：
[2-3 句话说明项目是什么，技术栈，当前状态]

**🎯 任务目标**：
[本任务要达成的具体目标，必须可验证]

**📁 核心文件**：
- `src/xxx/target.ts` - [修改] 添加 XXX 功能
- `src/xxx/reference.ts` - [参考] 查看现有实现模式

**🔨 执行步骤**：
1. [第一步：具体操作]
2. [第二步：具体操作]
3. [第三步：具体操作]

**✅ 完成标志**：
- [ ] [客观可验证的标准 1]
- [ ] [客观可验证的标准 2]

**⚠️ 注意事项**：
- [常见坑点]

文件: src/xxx/**/*.ts
排除: src/common/
验证: npm test -- xxx --silent
```

**字段说明**：
| 字段 | 必填 | 说明 |
|------|------|------|
| 🏠 项目背景 | ⭐ 推荐 | 执行者可能完全不了解项目 |
| 🎯 任务目标 | ✅ 必填 | 一句话说明最终要达成什么 |
| 📁 核心文件 | ✅ 必填 | 精确路径 + 操作类型 |
| 🔨 执行步骤 | ⭐ 推荐 | 3-5 步具体操作 |
| ✅ 完成标志 | ✅ 必填 | 客观可验证的 checklist |
| ⚠️ 注意事项 | ❌ 可选 | 常见坑点 |

**项目背景复用**：同一 STAGE 内可在头部写一次，任务可省略。

---

## 适用场景判断

### ✅ 适合 /todo-huge-task
- 多模块功能开发（用户、订单、支付等）
- 大规模重构（多个独立模块）
- 完整系统开发（前后端 + 测试）
- 数据迁移项目

### ❌ 不适合（用 /todo-write）
- 严格串行任务（无法并行）
- 高度耦合（都修改同一文件）
- 任务数 < 3 个
- 需要大量人工决策

---

## 💎 严格禁止

1. **模糊描述** ⛔ - 每个字段都要具体，不要"优化"、"完善"等模糊词
2. **省略项目背景** ⛔ - 执行者可能完全不了解项目
3. **省略核心文件** ⛔ - 必须列出精确路径
4. **缺少完成标志** ⛔ - 执行者需要知道如何验证完成

---

## 执行前输出

```markdown
✅ 任务文件已生成: ./todo-task

📊 执行计划:
- 总阶段数: [N] / 总任务数: [M]
- 可并行任务: [Y] ([Y/M]%)

🚀 下一步:
python batchcc.py todo-task --dry-run  # 预览
python batchcc.py todo-task            # 执行
```

---

## 相关文档
- @templates/workflow/DAG_TASK_FORMAT.md - 详细格式规范（含执行模型友好规范）
- @templates/workflow/DAG_TASK_TEMPLATE.md - 空白模板
- `/todo-write` - 简单串行任务
