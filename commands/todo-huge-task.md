---
description: 大任务智能拆分与 DAG 编排 ultrathink

---

# 大任务智能拆分与 DAG 编排

## 核心目标
将复杂任务智能拆分为 DAG 编排的多阶段执行计划，输出 `batchcc.py` 可执行的任务文件。

**关键约束**：任务描述要清晰简洁，目标明确可验证。

## 输入方式
```bash
/todo-huge-task "实现完整的用户管理系统"
/todo-huge-task $ARGUMENTS
```

---

## 🤖 自主执行原则

> **⛔ 强制阅读**：@templates/workflow/DAG_TASK_FORMAT.md（自主执行原则 + 执行模型友好规范）
>
> 核心：自主分析 → 自主决策 → 直接执行 → 记录理由（不询问用户）
>
> 决策失败时：标记任务 `failed`，说明原因和可选方案

---

## 执行策略

### 1. 充分探索项目 ⭐ 关键

**规划质量决定执行效率**。在生成任务前，必须深入理解项目：

- 阅读核心文档（README、CLAUDE.md、docs/FEATURE_CODE_MAP.md）
- 浏览项目结构，理解模块划分
- 查看现有代码模式和约定
- 识别技术栈和依赖关系

> **原则**：探索越充分，任务越精准，执行越高效。

### 2. 识别自然阶段

| 阶段 | 典型任务 | 执行模式 |
|------|---------|---------|
| 基础设施 | 数据库 schema、配置、第三方服务 | 串行 |
| 业务模块 | 用户、订单、支付等独立模块 | **并行** |
| 前端页面 | 各功能模块的 UI（可用 mock） | **并行** |
| 集成测试 | 模块间集成、API 联调 | 部分串行 |
| E2E 测试 | 完整业务流程验证 | **并行** |

### 3. 任务拆分原则

**粒度**：
- ✅ 功能模块级（model + service + controller + 测试）
- ❌ 太细（单文件）或太粗（整个系统）

**文件范围**：必须详细标注，用于自动冲突检测

### 4. 📂 输出文件结构（必须遵守）

生成的任务文件**必须包含文件头**（用于 `batchcc.py` 提取 Global Goal）：

```markdown
# [任务简名]

> **🏠 项目宏观目标**：
> [这里必须写一段话，描述整个大任务的最终形态]
> [这段话会被 batchcc 提取并注入给每一个子任务，作为最高优先级的指导原则]

## STAGE ## name="init" mode="serial"
...
```

### 5. TASK 格式规范

```markdown
## TASK ##
[任务标题]

**🏠 项目背景**：
[简述当前任务在宏观目标中的位置]

**🎯 目标**：[要达成什么]

**📁 核心文件**：
- `src/xxx/target.ts` - [修改] 添加 XXX
- `src/xxx/reference.ts` - [参考]

**✅ 完成标志**：
- [ ] [可验证的标准]

文件: src/xxx/**/*.ts
验证: npm test -- xxx --silent
```

**字段说明**：目标（必填）、核心文件（必填）、完成标志（必填）、项目背景（推荐）

---

## 适用场景判断

### ✅ 适合 /todo-huge-task
- 多模块功能开发（用户、订单、支付等）
- 大规模重构（多个独立模块）
- 完整系统开发（前后端 + 测试）
- 数据迁移项目

### ❌ 不适合（用 /todo-write）
- 严格串行任务（无法并行）
- 高度耦合（都修改同一文件）
- 任务数 < 3 个
- 需要大量人工决策

---

## 💎 严格禁止

1. **遗漏文件头** ⛔ - 必须包含 `# 标题` 和 `> 宏观目标`
2. **模糊描述** ⛔ - 不要"优化"、"完善"等模糊词，要具体
3. **省略核心文件** ⛔ - 必须列出精确路径
4. **缺少完成标志** ⛔ - 需要可验证的完成标准

---

## 执行前输出

```markdown
✅ 任务文件已生成: ./todo-task

📊 执行计划:
- 总阶段数: [N] / 总任务数: [M]
- 可并行任务: [Y] ([Y/M]%)
- 宏观目标: [已提取]

🚀 下一步:
python batchcc.py todo-task --dry-run  # 预览
python batchcc.py todo-task            # 执行
```

---

## 相关文档
- @templates/workflow/DAG_TASK_FORMAT.md - 格式严格参照此详细格式规范（含执行模型友好规范）
- @templates/workflow/DAG_TASK_TEMPLATE.md - 空白模板
- `/todo-write` - 简单串行任务