# E2E 测试就绪度检查

> **用途**：E2E 测试系统专项检查
>
> **适用场景**：E2E 测试出问题、重构测试系统前、补充缺失测试

---

## 🎯 检查目标

验证项目是否满足 E2E 驱动开发的基础条件。

**核心闭环**：
```
改代码 → 写测试 → 启动服务 → 运行测试 → 查看日志
                                    ↓
                          失败？立即修复 → ✅ 通过
```

---

## 🚀 检查流程

### Step 1: 基础设施评估

**识别技术栈**：
- 项目类型（Web / Mobile / Desktop）
- 测试框架（Playwright / Cypress / Detox）
- 测试命令位置（package.json / pytest.ini）

**验证可运行性** ⚠️ 强制执行：
```bash
# 实际运行测试
pnpm test:e2e  # 或 pytest tests/e2e/
```

检查：测试能否启动？环境配置错误？依赖缺失？

---

### Step 2: 测试覆盖度评估

**识别核心功能**（5-10 个，基于 FEATURE_CODE_MAP.md 或代码分析）

**检查每个功能**：
- 是否有对应的 E2E 测试文件？
- 测试是否覆盖核心流程？
- 测试是否覆盖错误场景？

**运行测试** ⚠️ 强制执行：分析失败原因、检查 skip/only

---

### Step 3: 测试质量评估（抽样 5-10 个测试文件）

**检查点**：
- 测试描述清晰？（Given-When-Then）
- 选择器规范？（优先 data-testid）
- 断言具体？（避免只检查可见性）
- 错误处理完善？（timeout、网络错误）

**稳定性**：
- flaky 测试？超时问题？依赖外部服务？

---

### Step 4: 测试-代码-文档一致性

选择 3-5 个重要功能：
- 测试验证的行为与代码实现一致？
- 代码新增功能有对应测试？
- 测试是否验证了文档描述的关键场景？

---

### Step 5: E2E 驱动就绪度

**评估项**：
- UI 元素定位容易？（data-testid 覆盖度）
- 测试数据容易准备？
- 服务启动自动化？日志查看方便？

**测量运行时间**：
```bash
time pnpm test:e2e
```

---

## 📊 输出格式

```markdown
## E2E 测试就绪度检查摘要

**项目**：[名称] | **检查时间**：[日期]

### 📊 总体评估

| 维度 | 评分 | 状态 |
|------|------|------|
| 基础设施 | X/10 | 🟢/🟡/🔴 |
| 测试覆盖度 | X/10 | 🟢/🟡/🔴 |
| 测试质量 | X/10 | 🟢/🟡/🔴 |
| E2E 驱动就绪度 | X/10 | 🟢/🟡/🔴 |

### 🚨 关键发现

**测试运行结果**：
- 通过：X 个 ✅ | 失败：X 个 ❌
- 失败列表（文件:行号 - 原因）

**缺失测试的核心功能**：
1. [功能名] - 优先级：高/中/低

### 💡 改进建议

**立即修复**：[高优先级任务]
**建议改进**：[中优先级任务]
```

---

## ⚠️ 禁止行为

- ❌ 不运行测试只看文件
- ❌ 写完测试不运行
- ❌ 测试失败仍交付
- ❌ 凭想象写测试（必须先理解代码）

---

## 📚 相关文档

| 文档 | 用途 |
|------|------|
| /comprehensive-health-check | 全面健康检查（DAG） |
| /health-check | 快速健康检查 |
| /test-plan | 测试规划（DAG） |

---

## 开始检查

**关键要求**：
- ✅ 必须实际运行测试
- ✅ 必须分析失败原因（具体到文件路径和行号）
- ✅ 必须给出具体修复建议
