# 会话保存

## 核心目标
保存当前会话的上下文、进度和待办任务，便于脚本连续调用 `/todo-doit` 自动完成大任务。

## ⚠️ 关键要求（支持自动化执行）

### 1. 必须有"下一步行动"
- **最重要的部分** - 让脚本知道该做什么
- 必须明确、可执行、包含验收标准
- 只写一个下一步任务（最优先的那个）

### 2. 任务状态清晰
- 进行中 → 标记为 `[~]`
- 待办 → 标记为 `[ ]`
- 已完成 → 标记为 `[x]` + 时间戳

### 3. 完成即停止
- 所有任务完成时，下一步行动标记为 `✅ 所有任务已完成`
- 不要编造新任务

## 保存内容

### 必须包含
- **🎯 下一步行动**: 唯一的下一个任务（最高优先级）
- **当前工作**: 正在做什么功能/修复什么问题
- **已完成内容**: 本次会话完成了哪些工作（具体到文件 + 时间戳）
- **待办任务**: 后续要做的事（优先级排序）
- **关键上下文**: 重要的技术决策、遇到的问题、解决思路

### 可选包含
- 相关文件引用（使用相对路径）
- 需要注意的风险点
- 待验证的假设

## 输出位置
项目根目录的 `TODO.md` 文件

## 编写原则
- **自动化友好**: 格式标准化，便于脚本解析
- **下一步明确**: 让脚本无需询问即可继续
- **任务可执行**: 每个任务清晰具体，包含验收标准
- **包含必要引用**: 提供文件路径便于定位
- **完成即停止**: 任务完成时明确标记，不强行继续

## 标准输出格式

```markdown
# TODO - [日期]

## 🎯 下一步行动
> 脚本将自动执行这个任务

- [ ] [具体任务] - [详细说明和验收标准]
  - 相关文件: `src/...`
  - 验收标准: [明确的完成条件]

<!-- 所有任务完成时改为：
## 🎯 下一步行动
✅ 所有任务已完成
-->

## 当前工作
[正在做什么功能/修复什么问题]

## 本次完成
- [x] 已完成任务1 - [2025-11-09 14:30]
- [x] 已完成任务2 - [2025-11-09 15:15]

## 待办任务

### 高优先级
- [ ] 任务1 - 说明和验收标准
- [ ] 任务2 - 说明和验收标准

### 普通优先级
- [ ] 任务3 - 说明和验收标准

## 关键上下文
- 技术决策1: 原因和影响
- 遇到的问题: 当前状态和思路

## 相关文件
- `src/...` - 说明
```

## 自动化执行示例

**脚本可以连续调用 `/todo-doit`：**

```bash
# 第一次调用
/todo-doit  # 读取"下一步行动"，执行任务1，完成后更新 TODO.md

# 第二次调用（自动）
/todo-doit  # 读取新的"下一步行动"，执行任务2，完成后更新 TODO.md

# 第三次调用（自动）
/todo-doit  # 读取到"✅ 所有任务已完成"，停止执行
```
