# 命令编写指南

本文件指导如何编写和优化 `commands/*.md` 斜杠命令。

> 命令索引和使用说明见 `@README.md`

---

## 设计原则

- **意图优先**：定义"做什么"和"为什么"，AI 自行决定"怎么做"
- **一类问题一个命令**：按用户视角的"一件事"划分，而非按技术操作划分
- **务实简洁**：文件控制在 100 行以内，简单够用 > 完美复杂
- **复用优先**：引用已有命令或 `@templates/`，不重复造轮子

---

## 命令形态

不同复杂度的命令适用不同写法：

### 原子型（单一目标，直接执行）

代表：`git-commit`, `claudemd`, `screen`

```markdown
# [Command Name]
## 目标
[一句话]
## 执行策略
[指导性方针，非具体 CLI 步骤]
## 约束条件
[限制和禁止项]
```

### 流程型（多阶段，可能含用户交互断点）

代表：`feat-discuss`, `feat-done`, `code-review`

```markdown
# [Command Name]
## 角色定位
[一句话定义在这个流程中扮演的角色]
## 核心工作流
### Phase/Step 1: [阶段名]
[该阶段的目标和策略]
### Phase/Step 2: [阶段名]
[该阶段的目标和策略]
## 约束条件
```

**流程型的判断标准**：
- 一个完整工作流中的多个阶段，用户期望一次调用走完
- 阶段之间有自然的交互断点（如等待外部输入）也可以，在命令中说明即可
- 阶段描述应是**目标和策略**，而非具体 CLI 操作

### DAG 型（生成任务文件，无人值守执行）

代表：`refactor-project`, `test-plan`, `todo-huge-task`

DAG 命令的产出是**任务文件**（非报告），通过 `batchcc.py` 自动化执行。
编写规范参见 DAG_TASK_FORMAT（通过 `@templates/workflow/` 自动加载到上下文）。

### 工具型（辅助操作，格式驱动）

代表：`todo-write`, `create-page-doc`

核心是定义**输出格式**，AI 按格式填充内容。输出格式定义可以内嵌在命令中。

---

## 编写规则

### 必须

- Frontmatter 包含 `description`（简短说明，显示在命令列表中）
- 开头明确命令的**核心目标**
- 约束条件中包含**禁止的操作**
- DAG 型命令引用 `@templates/workflow/` 而非内嵌格式说明

### 避免

- **微操指令**：不要写 `git status` → `cat file` → `grep xxx` 这样的 CLI 步骤序列
- **大段内嵌模板**：超过 10 行的模板应外置到 `templates/`（输出格式定义除外）
- **sleep 命令**：严禁使用
- **无用重复**：如果已有命令覆盖了某个能力（如 `/git-commit`），引用它而非重写

### 判断灰区

| 场景 | 建议 |
|------|------|
| 命令需要 Step 1/2/3？ | 流程型允许，但每步写目标而非操作 |
| 需要内嵌代码示例？ | 短示例（< 10 行）OK，长的外置到 templates |
| 一个命令做了 3 件事？ | 如果用户视角是"一件事"就 OK，按技术操作拆才需要分离 |
| 命令之间有重叠？ | 检查是否可以在一方引用另一方，而非各自实现 |

---

## 目录结构

```
commands/
├── CLAUDE.md              # 本文件（编写指南）
├── README.md              # 命令索引（面向用户）
├── *.md                   # 可执行命令
└── templates/
    ├── docs/              # 文档模板
    └── workflow/           # DAG 格式规范和示例
```

---

## 质量标杆

写得好的命令参考：`refactor.md`、`git-commit.md`、`claudemd.md`、`refactor-project.md`