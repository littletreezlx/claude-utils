---
description: 代码审查

---

# 代码审查

在功能分支开发完成后，对比 master 分支进行代码审查，生成审查报告和提测单。

---

## 执行步骤

### Step 1: 获取变更信息

执行以下 git 命令（并行）：
```bash
git log master..HEAD --oneline                    # 提交历史
git diff master...HEAD --stat                     # 变更统计
git diff master...HEAD --name-only                # 变更文件列表
git diff master...HEAD -- "*.kt" "*.java" "*.xml" # 具体代码变更
```

### Step 2: 逐文件审查

对每个变更文件，检查以下维度：

| 维度 | 检查点 |
|------|--------|
| **功能完整性** | 新增字段是否被使用？新增函数是否被调用？数据流是否完整？ |
| **Bug 风险** | 空值处理、边界条件、异常处理、并发安全 |
| **可读性** | 命名清晰度、逻辑直观性、注释必要性 |
| **规范性** | 魔法数字、代码格式、命名规范 |

### Step 3: 问题分级

按以下标准分类问题：

#### 🔴 严重（必须修复，阻塞合并）

符合以下**任一条件**即为严重：
- **功能缺失**：定义了但未使用的字段/函数，导致 UI 显示异常或功能不完整
- **逻辑错误**：条件判断错误、数据处理错误、状态管理错误
- **必现 Bug**：每次执行都会触发的问题，而非边缘情况
- **数据安全**：可能导致数据丢失、数据错误、数据泄露

#### 🟡 中等（建议修复，不阻塞合并）

符合以下条件：
- **潜在风险**：特定条件下可能出问题，但不是必现
- **可读性差**：魔法数字、命名不清、逻辑绕
- **规范问题**：代码格式、注释缺失、架构不一致
- **维护成本**：重复代码、过度耦合

#### 🟢 轻微（可选优化）

- 命名可以更好
- 可以更简洁
- 代码风格偏好

### Step 4: 生成文档

生成两份文档到 `docs/` 目录。

---

## 输出文档格式

### 文档1：代码审查报告

**文件名**: `docs/code-review-{分支名}-{日期}.md`

**面向**: 开发者

**内容结构**:

```markdown
# 代码审查报告

**分支**: xxx | **日期**: xxx | **审查人**: Claude Code

## 1. 变更概览
- 文件数/行数统计
- 主要功能变更点

## 2. 问题清单

### 🔴 严重问题
#### 2.x [问题标题]
**文件**: `文件路径:行号`
**问题**: 具体描述
**为什么严重**: 解释影响
**修复建议**: 具体方案或代码示例

### 🟡 中等问题
（同上格式）

### 🟢 轻微问题
（同上格式）

## 3. 总体评估
- 代码质量评分（1-10）
- 是否建议合并
- 合并前必须处理的清单
```

---

### 文档2：提测单

**文件名**: `docs/test-submission-{分支名}-{日期}.md`

**面向**: 测试同事

**内容结构**:

```markdown
# 提测单

**分支**: xxx | **日期**: xxx

## 1. 变更模块概览

| 模块 | 变更类型 | 影响范围 |
|------|---------|---------|
| xxx | 新增/修改/修复 | 影响的页面/流程 |

## 2. 具体变更内容

### [模块名]
- 新增：xxx
- 修改：xxx
- 修复：xxx

## 3. 测试入口
说明如何进入测试该功能

## 4. 风险提示
- 需要特别关注的场景
- 已知限制
```

**注意**：提测单只说明"改了什么"和"怎么进入"，不设计测试用例。

---

## 审查原则

1. **功能完整性优先** - 新增的代码必须被使用，数据流必须完整
2. **用户可见问题 = 严重** - 影响 UI 显示、影响核心流程的问题必须标记为严重
3. **不确定时偏严格** - 宁可多标严重，让开发者确认，也不要漏掉
4. **给出具体方案** - 每个问题都要有可操作的修复建议
