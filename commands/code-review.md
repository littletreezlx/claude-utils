# 代码审查

## 使用场景
在功能分支开发完成后,对比 master 分支的变更进行代码质量审查，并生成提测单。

**为什么合并这两个任务？**
- **Token 效率**：避免重复分析相同的代码变更（节省 40%-60% Token）
- **流程连贯**：代码审查和提测准备是开发完成后的连续动作
- **信息一致**：基于同一次分析生成两份文档，确保理解一致

## 分析方法

### 获取变更信息
通过 git 命令获取当前分支相对主分支的变更内容和提交历史，识别变更范围和影响面。

### 多维度质量分析
- **代码可读性**：命名是否清晰、结构是否易懂、逻辑是否直观
- **潜在Bug**：边界条件处理、空值检查、异常处理、逻辑漏洞
- **代码结构**：模块划分是否合理，职责是否清晰
- **可维护性**：注释质量、代码复杂度、重复代码
- **规范性**：是否符合项目编码规范和架构原则

### 风险评估
识别变更的影响范围（局部/模块/系统级）和潜在问题的严重程度（严重/中等/轻微），标注需要优先处理的问题。

### 变更影响分析
基于已获取的变更信息，识别：
- 涉及哪些模块和功能
- 影响哪些页面/接口/业务流程
- 潜在的业务风险和技术风险

## 输出要求

生成两份文档（基于同一次代码分析）：

### 文档1：代码审查报告（面向开发）

保存到 `docs/code-review-{branch-name}-{date}.md`，包含：

#### 1. 变更概览
- 变更文件数量和类型分布
- 主要功能变更点
- 代码行数统计（增加/删除）

#### 2. 问题清单
按严重程度分类列出发现的问题：
- 🔴 严重：必须修复（逻辑错误、明显Bug、功能缺陷）
- 🟡 中等：建议修复（可读性差、潜在Bug风险、代码规范问题）
- 🟢 轻微：可选优化（命名改进、注释补充、代码简化）

#### 3. 改进建议
针对每个问题提供：
- 具体的问题描述和位置（文件:行号）
- 为什么这是个问题（重点说明对可读性和稳定性的影响）
- 具体可行的修改方案或代码示例

#### 4. 文档检查
- [ ] 是否需要更新 README.md

#### 5. 总体评估
- 代码质量评分（1-10）
- 是否建议合并到 master
- 合并前必须处理的问题清单

---

### 文档2：提测单（面向测试）

保存到 `docs/test-submission-{branch-name}-{date}.md`，包含：

#### 1. 变更模块概览

使用表格列出变更的模块：

| 模块 | 变更类型 | 影响范围 |
|------|---------|---------|
| [模块名] | 新增功能/Bug修复/功能优化 | [影响的页面/接口/流程] |

#### 2. 具体变更内容

按模块详细说明：

**[模块名]**
- 新增：[具体新增的功能]
- 修改：[具体修改的功能]
- 修复：[具体修复的问题]
- 影响：[影响的页面/接口/流程]

#### 3. 风险提示
- [需要特别关注的场景]
- [可能的影响范围]
- [已知的限制和约束]

**注意**：提测单只说明"改了什么"和"影响哪里"，具体的测试用例设计、测试数据准备由测试同事根据专业判断完成。

## 审查原则
- **可读性优先**：代码应该让人一眼就能看懂意图和逻辑
- **关注Bug风险**：重点识别边界条件、异常处理、状态管理等容易出错的地方
- **平衡质量与效率**：避免过度要求完美，关注实际问题
- **提供具体建议**：给出可操作的修改方案，而非空泛的指导
- **基于项目规范**：结合项目特点和团队规范进行评判
